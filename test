# Renault R4 E-Tech - Complete API Analysis & Read-Only Architecture Documentation

## Summary
Comprehensive testing of Renault R4 E-Tech (Model A4E1VE) reveals a **read-only API architecture** due to simplified TCU (AIVCT) and `connectivityTechnology: NONE`. This affects all 2024+ R4 E-Tech models and explains "unavailable" sensors in Home Assistant integration.

## Vehicle Information
- **Model**: Renault R4 E-Tech (A4E1VE)
- **VIN Pattern**: VYSP01H007XXXXXX
- **Manufacturing Date**: September 2025
- **Delivery Date**: January 2026
- **Market**: Poland (PL)
- **Battery**: BTGAE (NMC type), 52kWh
- **TCU**: AIVCT (AI Virtual Connection Technology)
- **Connectivity Technology**: `NONE` âš ï¸
- **Family**: X1317

## Key Findings

### âœ… Working Endpoints (Read-Only)

#### 1. Battery Status
**Endpoint**: `/kamereon/kca/car-adapter/v2/cars/{vin}/battery-status`

**Available Data**:
```json
{
  "batteryLevel": 80,
  "batteryAutonomy": 190,
  "batteryCapacity": 0,
  "batteryAvailableEnergy": 0,
  "plugStatus": 1,
  "chargingStatus": 0.3,
  "chargingRemainingTime": 22,
  "chargingInstantaneousPower": 0.0,
  "V2L_SystemStatusDisplay": 0
}
```

**Missing Fields** (compared to Megane/Scenic E-Tech):
- `batteryTemperature` - NOT returned
- `batteryCapacity` - Returns 0
- `batteryAvailableEnergy` - Returns 0
- `chargingInstantaneousPower` - Returns 0.0

#### 2. Cockpit
**Endpoint**: `/kamereon/kca/car-adapter/v1/cars/{vin}/cockpit`

**Available Data**:
```json
{
  "totalMileage": 198.0,
  "fuelQuantity": 0.0,
  "fuelAutonomy": 0.0
}
```

#### 3. Location
**Endpoint**: `/kamereon/kca/car-adapter/v1/cars/{vin}/location`

**Available Data**:
```json
{
  "gpsLatitude": 52.XXXXX,
  "gpsLongitude": 20.XXXXX,
  "lastUpdateTime": "2026-01-31T07:51:48Z"
}
```

#### 4. HVAC Status
**Endpoint**: `/kamereon/kca/car-adapter/v1/cars/{vin}/hvac-status`

**Available Data**:
```json
{
  "hvacStatus": "off",
  "socThreshold": 15.0,
  "externalTemperature": null
}
```

**Missing**: `externalTemperature` always null

#### 5. ðŸŽ‰ Charges History (VALUABLE!)
**Endpoint**: `/kamereon/kca/car-adapter/v1/cars/{vin}/charges`

**Parameters**: `?start=YYYYMMDD&end=YYYYMMDD&country=PL`

**Available Data**:
```json
{
  "charges": [
    {
      "chargeStartDate": "2026-01-30T21:05:40Z",
      "chargeEndDate": "2026-01-31T05:05:36Z",
      "chargeEndStatus": "ok",
      "chargeStartBatteryLevel": 80,
      "chargeEndBatteryLevel": 80,
      "chargeEnergyRecovered": 15.050001,
      "chargeDuration": 479
    }
  ]
}
```

**This is extremely valuable** for cost tracking and efficiency analysis!

#### 6. Vehicle Details
**Endpoint**: `/commerce/v1/accounts/{account}/kamereon/kca/car-adapter/v2/cars/{vin}/details`

**Critical Fields**:
```json
{
  "tcu": {
    "code": "AIVCT",
    "label": "WITH AIVC CONNECTION UNIT"
  },
  "connectivityTechnology": "NONE",
  "battery": {
    "code": "BTGAE",
    "label": "BATTERY BTGAE"
  },
  "batteryType": "NMC",
  "engineEnergyType": "ELEC"
}
```

### âŒ Non-Working Endpoints (403 Forbidden)

All **write/control** endpoints return `err.func.wired.forbidden`:

1. **Charge Mode** - `GET/POST .../charge-mode` â†’ 403
2. **Charge Schedule** - `GET/POST .../charge-schedule` â†’ 403
3. **Charging Settings** - `GET .../charging-settings` â†’ 403
4. **HVAC Settings** - `GET .../hvac-settings` â†’ 403
5. **HVAC Start/Stop** - `POST .../actions/hvac-start` â†’ 403
6. **Charging Start/Stop** - `POST .../actions/charging-start` â†’ 403
7. **New KCM Endpoints** - `GET .../kcm/v1/vehicles/{vin}/...` â†’ 403

### âŒ Non-Existing Endpoints (404 Not Found)

1. **Lock Status** - `GET .../lock-status` â†’ 404
   - Error: `"There is no data for this vin and uid"`
2. **Notification Settings** - `GET .../notification-settings` â†’ 400
   - Error: `"The vehicle does not have a GDC gateway"`
3. **Contracts** - `GET .../contracts` â†’ 404
4. **Res State** - `GET .../res-state` â†’ 404
5. **Charge History (aggregated)** - `GET .../charge-history` â†’ 404
6. **HVAC History** - `GET .../hvac-history` â†’ 404

## Account Information
```json
{
  "accountType": "MYRENAULT",
  "accountStatus": "ACTIVE",
  "linkType": "OWNER",
  "connectedDriver": {
    "role": "MAIN_DRIVER"
  },
  "connectivityTechnology": "NONE",
  "vehicleDetails": {
    "tcu": {
      "code": "AIVCT",
      "label": "WITH AIVC CONNECTION UNIT"
    }
  }
}
```

## MyRenault App Confirmation

**Tested in official MyRenault mobile app (Android v31)**:
- âŒ Remote HVAC start - NOT available
- âŒ Charge scheduling - NOT available
- âŒ Preconditioning - NOT available
- âŒ Charge mode selection - NOT available
- âœ… Battery status - Available
- âœ… Location - Available
- âœ… Charging status - Available

**Conclusion**: This is **NOT an API permission issue** - it's the vehicle's hardware/firmware design.

## Comparison: R4 E-Tech vs Megane/Scenic E-Tech

| Feature | R4 E-Tech (AIVCT) | Megane/Scenic (TCU2.1) |
|---------|-------------------|------------------------|
| Connectivity Tech | `NONE` | `ECC3` |
| Battery monitoring | âœ… Basic | âœ… Advanced |
| Battery temperature | âŒ | âœ… |
| Charging power | âŒ | âœ… |
| Remote HVAC | âŒ | âœ… |
| Remote charge control | âŒ | âœ… |
| Charge scheduling | âŒ | âœ… |
| Lock/unlock | âŒ | âœ… |
| Charges history | âœ… | âœ… |
| GDC Gateway | âŒ | âœ… |

## Root Cause Analysis

### Hardware Limitation
R4 E-Tech uses **AIVCT (AI Virtual Connection Technology)** instead of **TCU 2.1**:
- AIVCT = Simplified, read-only telematics unit
- TCU 2.1 = Full bidirectional control unit with GDC gateway

### Why This Design?
1. **Cost reduction** - R4 is a budget-friendly model
2. **Market positioning** - Premium features reserved for higher-tier models (Megane, Scenic)
3. **Possible future unlock** - OTA update or paid subscription (speculation)

## Impact on Home Assistant Integration

### Sensors That Work
- âœ… `sensor.r4_battery_level`
- âœ… `sensor.r4_battery_autonomy`
- âœ… `sensor.r4_charging_remaining_time`
- âœ… `binary_sensor.r4_plugged_in`
- âœ… `binary_sensor.r4_charging`
- âœ… `sensor.r4_mileage`
- âœ… `device_tracker.r4`
- âœ… `binary_sensor.r4_hvac_status`

### Sensors That Will Be "Unavailable"
- âŒ `sensor.r4_battery_temperature`
- âŒ `sensor.r4_charging_power`
- âŒ `sensor.r4_outside_temperature`
- âŒ `select.r4_charge_mode`
- âŒ `button.r4_start_charge`
- âŒ `button.r4_ac_start`

**This is EXPECTED behavior** - not a bug or configuration issue.

## Recommendations

### For Library Developers (@epenet @jmcollin78)
1. Add R4 E-Tech (A4E1VE) to known limited models
2. Document `connectivityTechnology: NONE` behavior
3. Consider adding `/charges` endpoint support for historical data
4. Add vehicle capability detection based on TCU type:
   - `AIVCT` â†’ Read-only mode
   - `TCU2.1` â†’ Full control mode
5. Expose additional battery attributes:
   - `V2L_SystemStatusDisplay`
   - `socThreshold`
   - `chargingRemainingTime`

### For Home Assistant Users
1. Use official HA integration for **monitoring only**
2. Control charging via wallbox/EVSE (not through vehicle API)
3. Use MyRenault app for any manual interventions
4. Leverage `/charges` endpoint for cost tracking via custom integration

### Custom Template Sensors (Workaround)
```yaml
template:
  - sensor:
      - name: "R4 Charging Time Remaining"
        unique_id: r4_charging_time_remaining
        state: "{{ state_attr('sensor.r4_battery_level', 'chargingRemainingTime') | int }}"
        unit_of_measurement: "min"
        device_class: duration
        
      - name: "R4 V2L Status"
        unique_id: r4_v2l_status
        state: "{{ state_attr('sensor.r4_battery_level', 'V2L_SystemStatusDisplay') }}"
        
      - name: "R4 SOC Threshold"
        unique_id: r4_soc_threshold
        state: "{{ state_attr('sensor.r4_hvac_status', 'socThreshold') }}"
        unit_of_measurement: "%"
```

## Testing Environment

- **Library**: renault-api 0.5.3 (CLI)
- **Method**: Direct HTTP endpoint testing via `renault-api http get`
- **Authentication**: Gigya JWT + Kamereon tokens
- **Test Date**: January 31, 2026
- **Vehicle Mileage**: ~200 km
- **Delivery Age**: 11 days
- **Platform**: macOS with Python 3.x

### Test Commands Used
```bash
# Battery status
renault-api http get "/commerce/v1/accounts/{account}/kamereon/kca/car-adapter/v2/cars/{vin}/battery-status?country=PL"

# Charges history (last 30 days)
renault-api http get "/commerce/v1/accounts/{account}/kamereon/kca/car-adapter/v1/cars/{vin}/charges?start=20260101&end=20260131&country=PL"

# Account details
renault-api http get "/commerce/v1/accounts/{account}"

# Vehicle list
renault-api http get "/commerce/v1/accounts/{account}/vehicles?country=PL"
```

## Related Issues

- Home Assistant Core #158187 - R4 E-Tech sensors unavailable
- renault-api #1491 - New endpoint paths discovered
- renault-api #1638 - Scenic E-Tech comprehensive testing
- renault-api #1443 - Scenic E-Tech endpoint changes

## Additional Notes

### Battery Data Anomaly
Some charge sessions show unusual values during initial vehicle setup:
```json
{
  "chargeStartBatteryLevel": 0,    // Incorrect initial sync
  "chargeEndBatteryLevel": 60,     // Correct
  "chargeEnergyRecovered": 0.05    // Too low for 0â†’60%
}
```

This suggests **initial data synchronization issues** or **vehicle telematics learning period** after delivery.

### Phantom Drain Detection
One session shows negative energy recovery:
```json
{
  "chargeEnergyRecovered": -0.65,
  "chargeStartBatteryLevel": 80,
  "chargeEndBatteryLevel": 78
}
```

This indicates **phantom drain** or **battery conditioning** during charging session. The `/charges` endpoint is valuable for tracking this behavior.

### V2L (Vehicle-to-Load) Support
The `V2L_SystemStatusDisplay` attribute is present but always returns `0`. This suggests:
- Hardware support for V2L exists in R4 E-Tech
- Feature may be disabled in software
- Future activation via OTA possible

## Conclusion

Renault R4 E-Tech has **intentionally limited API connectivity** due to:
1. Simplified TCU hardware (AIVCT vs TCU2.1)
2. `connectivityTechnology: NONE` configuration
3. No GDC gateway support
4. Cost optimization strategy

**This is not a bug** - it's the vehicle's design. Users should:
- Accept read-only monitoring via HA/renault-api
- Use wallbox/EVSE for charging control
- Leverage charges history endpoint for analytics
- Consider wallbox integration (e.g., Wallbox, Easee, Zaptec) for smart charging

**For developers**: R4 E-Tech should be classified as "limited connectivity model" alongside any other vehicles with `connectivityTechnology: NONE`.

---

**Model Family Affected**:
- Renault R4 E-Tech (A4E1VE)
- Family: X1317
- Manufacturing: 2024+
- Markets: Confirmed in Poland, likely all EU markets

**VIN Pattern**: VYSP01H007XXXXXX (Poland market, may vary by country)

## Test Data Availability

I'm willing to provide additional testing data if needed:
- âœ… Full endpoint responses (anonymized)
- âœ… Different API scenarios
- âœ… Long-term data collection
- âœ… Firmware update testing (when available)
- âœ… Additional R4 E-Tech vehicles from community

The `/charges` endpoint is particularly valuable for cost tracking in countries with variable electricity tariffs (e.g., Poland's G12 tariff with peak/off-peak pricing). I've successfully integrated this with Home Assistant for automatic cost calculation.

## Proposed Library Changes

### 1. Add R4 E-Tech Model Detection
```python
# In models.py or vehicle capabilities detection
AIVCT_MODELS = [
    "A4E1VE",  # R4 E-Tech
]

def get_vehicle_capabilities(vehicle_details):
    tcu_code = vehicle_details.get('tcu', {}).get('code')
    connectivity = vehicle_details.get('connectivityTechnology')
    
    if tcu_code == 'AIVCT' or connectivity == 'NONE':
        return VehicleCapabilities(
            remote_hvac=False,
            remote_charging=False,
            charge_schedule=False,
            lock_unlock=False,
            monitoring=True,
            charges_history=True
        )
    # ... existing TCU2.1 logic
```

### 2. Expose Additional Battery Attributes
```python
# In battery sensor
@property
def extra_state_attributes(self):
    attrs = super().extra_state_attributes
    if self.data.get('V2L_SystemStatusDisplay') is not None:
        attrs['v2l_status'] = self.data.get('V2L_SystemStatusDisplay')
    if self.data.get('chargingRemainingTime'):
        attrs['charging_remaining_time'] = self.data.get('chargingRemainingTime')
    return attrs
```

### 3. Add Charges History Endpoint
```python
async def get_charges_history(
    self,
    start_date: str,  # YYYYMMDD
    end_date: str,    # YYYYMMDD
) -> Dict[str, Any]:
    """Get charging history for date range."""
    return await self._request(
        "GET",
        f"commerce/v1/accounts/{self.account_id}/kamereon/kca/car-adapter/v1/cars/{self.vin}/charges",
        params={"start": start_date, "end": end_date, "country": self.country}
    )
```

## Community Impact

This documentation will help:
1. **R4 E-Tech owners** understand their vehicle's API limitations
2. **Home Assistant users** set correct expectations for sensor availability
3. **Integration developers** implement proper capability detection
4. **Future R4 buyers** make informed decisions about connectivity features

Thank you for maintaining this excellent library! ðŸš—âš¡

---

**Testing conducted by**: Mariusz (Poland market)
**Vehicle delivery**: January 2026
**Library version**: renault-api 0.5.3
```

---

# ðŸ“‹ **CZÄ˜ÅšÄ† 2: GitHub Issue dla Home Assistant Core**

**URL**: https://github.com/home-assistant/core/issues/new/choose

**Wybierz**: Bug Report

**TytuÅ‚**:
```
[renault] R4 E-Tech - Limited connectivity architecture (AIVCT TCU, no remote control)
